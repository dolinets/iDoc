var express=require("express"),path=require("path"),favicon=require("serve-favicon"),logger=require("morgan"),cookieParser=require("cookie-parser"),bodyParser=require("body-parser"),lessMiddleware=require("less-middleware"),index=require("../server/routes/index"),ejs=require("ejs"),log=require("../server/libs/log")(module),multer=require("multer"),upload=multer(),engines=require("consolidate"),sendmail=require("../server/sendmail"),app=express();app.set("views",path.join(__dirname+"/")),app.set("view engine","ejs"),app.use(favicon(path.join(__dirname,"/","favicon.ico"))),app.use(logger("dev")),app.use(bodyParser.json()),app.use(bodyParser.urlencoded({extended:!1})),app.use(cookieParser()),app.use(lessMiddleware(path.join(__dirname,"app"))),app.use(express["static"](path.join(__dirname,"app"))),app.use("/",index),app.post("/",upload.array(),function(a,b,c){log.info(a.body),sendmail.StartSendEmail(a.body),b.clearCookie()}),app.use(function(a,b,c){var d=new Error("Not Found");d.status=404,c(d)}),app.use(function(a,b,c,d){c.locals.message=a.message,c.locals.error="development"===b.app.get("env")?a:{},c.status(a.status||500),c.render("error")}),module.exports=app;