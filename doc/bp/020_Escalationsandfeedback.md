# Эскалации

Эскалации создаются для каждой юзертаски каждого бизнес-процесса. Бывает так что для некоторых юзертасок не нужно генерировать эскалации - аналитик решает это сам, учитывая специфику бизнес-процесса.

На данный момент эскалации бывают 2-х типов - уведомление на почту и генерирование (порождение) эскалационной заявки. 
Порождение эскалационной заявки на одной юзертаске происходит только один раз, в то время как письма могут генерироваться на одной юзертаске более одного раза.  
Рекомендуется прописывать оба этих типа эскалаций для каждой юзертаски.  
Правила вносятся в файл [EscalationRule](https://github.com/e-government-ua/iBP/wiki/%D0%9A%D0%BE%D0%BD%D1%84%D0%B8%D0%B3%D1%83%D1%80%D0%B0%D1%86%D0%B8%D0%BE%D0%BD%D0%BD%D1%8B%D0%B5-%D1%84%D0%B0%D0%B9%D0%BB%D1%8B#escalationrule). Путьк файлу: i\wf-base\src\main\resources\data\prod\EscalationRule.csv

## Подробное описание одного из параметров: sCondition
Правила запуска эскалаций можно настроить более гибко комбинируя между собой 2 условия:  
ассайнутость таски и количество дней/часов  
**bAssigned==false** - заявка находится в "необроблених"  
**bAssigned==true** - заявка находится у кого-то "в работе"  
**nDaysLimit** - количество дней при достижении которого сработает эскалация - параметр необходим для создания условия.   Вместо параметра nDaysLimit условие можно создавать напрямую прописывая конкретные цифры. Например, вот это равные условия:  
```
"nElapsedHours >= nDaysLimit";"{nDaysLimit:0}"  
"nElapsedHours >= 0";"{nDaysLimit:0}"  
```
**nDueElapsedDays**  - количество дней с момента последнего действия с заявкой  
**nElapsedDays** - количество дней с момента создания заявки (вроде как одно и тоже с nCreateElapsedDays)  
**nCreateElapsedDays** - количество дней с момента создания заявки на юзертаске  
**nElapsedHours**  - количество часов с момента создания заявки (вроде как одно и тоже с nCreateElapsedHours)  
**nCreateElapsedHours** - количество часов с момента создания заявки на юзертаске  
**nDays** - разница (в днях) между сегодняшней датой и датой подачи заявки  

Пример самых ходовых правил (sCondition):
```
"(nDays >= 0)&&(bAssigned==false)”
"(nDays >= 0)&&(bAssigned==true)”
"(nElapsedDays >= nDaysLimit)&&(bAssigned==false)"
"(nElapsedDays >= nDaysLimit)&&(bAssigned==true)"
```
Так же стоит учитывать знаки условия:  
nDays >= 5 - правило будет срабатывать каждый день, начиная с пятого дня  
nDays ==5 - правило сработает только в пятый день  
nDays != 5 - правило сработает во все дни кроме пятого  

**отправить письмо** 
```
431;dnepr_soc_help_148;"usertask1";"nElapsedHours >= nDaysLimit";"{nDaysLimit:-1, asRecipientMail:['darja.grek@gmail.com']}";"escalation/escalation_template.html";1  
442;dnepr_cnap_261;"usertask1";"(nDays >= 0)&&(bAssigned==false)";"{nDaysLimit:-1, asRecipientMail:['darja.grek@gmail.com']}";"escalation/escalation_template.html";1
```
**породить эскалационную заявку** 
```
432;dnepr_soc_help_148;"usertask1";"nElapsedHours >= nDaysLimit";"{nDaysLimit:-1}";"escalation/escalation_template.html";2
443;dnepr_cnap_261;"usertask1";"(nDays >= 0)&&(bAssigned==false)";"{nDaysLimit:-1}";"escalation/escalation_template.html";2
```
	
## Порядок работы с эскалационными заявками:
1. За каждым аналитиком закреплен свой населенный пункт, за отработку заявок которого он отвечает  
2. Аналитик берет в работу только заявки которые относятся к его населенному пункту, звонит в орган который не отработал или долго удерживает заявку, выясняет причины и вносит в поле: “Коментар за результатами контакту з адміністративним органом.” [Речевой модуль](https://github.com/e-government-ua/iBP/wiki/%D0%AD%D1%81%D0%BA%D0%B0%D0%BB%D0%B0%D1%86%D0%B8%D0%B8-%D0%B8-%D1%84%D0%B8%D0%B4%D0%B1%D0%B5%D0%BA%D0%B8#%D0%A0%D0%B5%D1%87%D0%B5%D0%B2%D0%BE%D0%B9-%D0%BC%D0%BE%D0%B4%D1%83%D0%BB%D1%8C-%D0%BF%D1%80%D0%B8-%D0%B7%D0%B2%D0%BE%D0%BD%D0%BA%D0%B5-%D0%B2-%D0%B3%D0%BE%D1%81%D0%BE%D1%80%D0%B3%D0%B0%D0%BD).  
3. В случае если в исходной заявке произошли какие-то изменения (заявка взята в работу из необработанных, заявка перешла на новую юзертаску, заявка была отработана), то эскалационная заявка автоматически удаляется. Другого пути закрыть эскалационную заявку не существует - чтоб эскалационная заявка закрылась - необходимо движение по исходной заявке. Отработка эскалационной заявки подразумевает выяснение причины неотработки и перенос срока рассмотрения эскалационной заявки.  
4. Все комментарии которые внес волонетёр - будут переданы в историю исходной заявки и будут отображены в “Мій журнал”, т.е. заявитель и чиновник их смогут увидеть. Если после переноса срока заявка снова вернется в необработанные, это будет означать что никакого движения по ней не произошло и нужно снова звонить в гос.орган.  

**Для того чтоб в эскалационную заявку передались контакты гос.органа, с которым нужно связаться, нужно заполнить 3 файла:**

[Subject](https://github.com/e-government-ua/iBP/wiki/%D0%9A%D0%BE%D0%BD%D1%84%D0%B8%D0%B3%D1%83%D1%80%D0%B0%D1%86%D0%B8%D0%BE%D0%BD%D0%BD%D1%8B%D0%B5-%D1%84%D0%B0%D0%B9%D0%BB%D1%8B#subject)  
действия аналитика: добавить имя чиновника или название органа (то есть name пользователя или name группы)  
**пример внесения чиновника:**  
323;;Мартинов Іван Станіславович;  
**пример внесения органа:**  
539;;_УПСЗН м.Бориспіль;  

[SubjectAccount](https://github.com/e-government-ua/iBP/wiki/%D0%9A%D0%BE%D0%BD%D1%84%D0%B8%D0%B3%D1%83%D1%80%D0%B0%D1%86%D0%B8%D0%BE%D0%BD%D0%BD%D1%8B%D0%B5-%D1%84%D0%B0%D0%B9%D0%BB%D1%8B#subjectaccount)  
действия аналитика: добавить ИД пользователя или ИД ГРУПЫ  
**пример внесения чиновника:**  
51;cnap_chortT_1;Артур Шимків;1;0;51  
**пример внесения органа:**  
1086;upszn66;УПСЗН смт.Оратів;1;0;1086  

[SubjectContact](https://github.com/e-government-ua/iBP/wiki/%D0%9A%D0%BE%D0%BD%D1%84%D0%B8%D0%B3%D1%83%D1%80%D0%B0%D1%86%D0%B8%D0%BE%D0%BD%D0%BD%D1%8B%D0%B5-%D1%84%D0%B0%D0%B9%D0%BB%D1%8B#subjectcontact)  
действия аналитика: добавить для одного и того же Subject (это будет или конкретный пользователь или орган) все возможные контакты  
пример:  
3001;1524;0;(05133)24335,23614  
3002;1524;1;utszn_kroz@ukr.net  
Для Subject 1524(это УПСЗН-смт.Криве) внесен телефон  и емайл  

## Речевой модуль при звонке в гос.орган
**Українська версія**
> Доброго дня!  
> Мене звуть %ім'я%, я один з координаторів порталу iGov в %назву% області.  
> Кілька днів тому було відправлено звернення в електронному вигляді на порталі iGov в вашу службу.  
> Ми отримали інформацію про те, що вона до сьогодні не взята в роботу, тому хотіли б уточнити у Вас, з якої саме причини?   Можливо, у вас виникли проблеми в роботі з порталом?  
> Можливо, я би міг допомогти вам у вирішенні даних питань?  
(Записуєте результат розмови в коментарі).  
> Дякую за приділений час, на все добре, до побачення!  

**Російська версія**
> Добрый день!  
> Меня зовут %имя%, я один из координаторов портала iGov в %название% области.  
> Несколько дней назад было отправлено обращение в электронном виде на портале  iGov в вашу службу.  
> Мы получили информацию о том, что она до сих пор не взята в работу, поэтому хотели бы уточнить у Вас, по какой именно причине, возможно, у вас возникли сложности в работе с порталом?  
> Возможно, я мог(ла) бы помочь вам в решении данных вопросов?  
> (Записываете результат разговора в комментарии).  
> Спасибо за уделенное время, всего хорошего!  


